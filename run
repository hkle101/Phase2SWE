
#!/usr/bin/env bash
# Simple runner for repo2. Usage:
#   ./run            -> run CLI with urls.txt (default)
#   ./run install    -> install requirements
#   ./run test       -> run pytest
#   ./run <file>     -> run CLI with provided URL file

set -euo pipefail

cmd=${1:-}

if [ "${cmd:-}" = "install" ]; then
    pip install --user -r requirements.txt
    exit 0
fi

if [ "${cmd:-}" = "test" ]; then
    # Try running pytest with coverage; if the pytest in this environment
    # doesn't recognize --cov, fall back to a plain pytest run.
    if ! pytest --maxfail=1 --disable-warnings -q --cov=cli; then
        echo "pytest --cov failed, retrying without coverage"
        pytest -q
    fi
    exit 0
fi

# If an argument is provided and it's a file, run with that file
if [ -n "${cmd:-}" ] && [ -f "${cmd}" ]; then
    python3 -m cli.main "$cmd"
    exit 0
fi

# Default: run interactive menu (main.py now exposes interactive mode)
python3 -m cli.main
exit 0

echo "Usage: ./run [install|test|URL_FILE]"
exit 1